<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
<meta property="og:type" content="website" />
<meta property="og:title" content="クラウド環境でのルータ設定(後編)" />
<meta property="og:site_name" content="IIJ">
<meta property="og:url" content="http://www.iij.ad.jp/company/development/tech/activities/saw1-02/index.html">
<meta property="og:image" content="http://pr.iij.ad.jp/facebook/images/fb_RD.png">
<meta property="og:description" content="IIJの研究・開発「クラウド環境でのルータ設定(後編)」のページです。">

<title>クラウド環境でのルータ設定（後編） | 最新の技術動向 | IIJ</title>

<meta name="keywords" content="クラウド環境でのルータ設定（後編）,株式会社インターネットイニシアティブ,IIJ,ネットワーク,ソリューション">
<meta name="description" content="IIJはインターネット接続サービスからアウトソーシングサービス、システムインテグレーションに至るまで、総合的なソリューションサービスを提供しています。">
<meta name="copyright" content="(C) Internet Initiative Japan Inc." />
<meta name="robots" content="index,follow" />
<link rel="contents" href="http://www.iij.ad.jp/index.html" title="ホーム" />
<link rel="help" href="http://www.iij.ad.jp/contact/index.html" title="お問い合わせ" />
<link rel="index" href="http://www.iij.ad.jp/sitemap/index.html" title="サイトマップ" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="stylesheet" type="text/css" href="/common/css/import.css" media="all" />
<link rel="stylesheet" type="text/css" href="/common/css/jquery.lightbox.css" media="all" />
<link rel="stylesheet" type="text/css" href="/common/css/print.css" media="print" />
<script language="javascript" type="text/javascript" src="/common/js/jquery.js"></script>
<script type="text/javascript" src="/common/js/jquery.rollover.js"></script>
<script type="text/javascript" src="/common/js/jquery.scroll.js"></script>
<script type="text/javascript" src="/common/js/jquery.autoheight.js"></script>
<script type="text/javascript" src="/common/js/jquery.lightbox.js"></script>
<script type="text/javascript" src="/common/js/common.js"></script>
<script type="text/javascript" src="http://www.iij.ad.jp/common/js/clicktag.js"></script>

</head>
<body>
<div id="page-wrapper">
<p class="reader">ページの先頭です</p>
<hr />
<dl class="reader">
<dt>ページ内移動用のリンクです</dt>
<dd>
<ul>
<li><a href="#gNavi">サイト内共通メニューへ移動します</a></li>
<li><a href="#header">ヘッダーメニューへ移動します</a></li>
<li><a href="#contentsContainer">本文へ移動します</a></li>
</ul>
</dd>
</dl>
<hr />
<div id="header-container">
<div id="header">
<div id="header-wrapper">
<p id="logo"><a href="/index.html"><img src="/common/images/hd_logo01.png" width="136" height="95" alt="IIJ" /></a></p>
<div id="header-utility">
<p id="connected"><a href="/IPv6/ipv4v6.html"><img src="/common/images/hd_btn02.gif" width="112" height="13" alt="IPv4/v6アイコン" /></a></p>
<ul>
<li><a href="/contact/index.html">お問い合わせ</a></li>
<li><a href="/sitemap/index.html">サイトマップ</a></li>
</ul>
<form action="http://search2.iij.ad.jp/ja_all/search.x" method="get" id="search-box">
<input type="text" name="q" id="MF_form_phrase" autocomplete="off" />
<input type="image" src="/common/images/hd_btn04.gif" alt="検索" value="検索" id="search-btn" />
<input type="hidden" name="ie" value="UTF-8" />
<input type="hidden" name="page" value="1" />
</form>
<p id="language"><a href="/en/index.html"><img src="/common/images/hd_btn03.gif" width="61" height="32" alt="English" class="rollover" /></a></p>

<!-- header-utility End -->
</div>
<ul id="gNavi">
<li><a href="/index.html"><img src="/common/images/gNavi_btn01.png" width="54" height="56" alt="HOME" class="rollover" /></a></li>
<li><a href="/svcsol/index.html"><img src="/common/images/gNavi_btn02.png" width="214" height="56" alt="サービス・ソリューション" class="rollover" /></a></li>
<li><a href="/company/index.html"><img src="/common/images/gNavi_btn03on.png" width="214" height="56" alt="企業情報" /></a></li>
<li><a href="/ir/index.html"><img src="/common/images/gNavi_btn04.png" width="214" height="56" alt="株主・投資家向け情報" class="rollover" /></a></li>
</ul>
<!-- header-wrapper End -->
</div>
<ol id="path">
<li><a href="/index.html">ホーム</a></li>

<li><a href="/company/index.html">企業情報</a></li>
<li><a href="/company/development/index.html">研究・開発</a></li>
<li><a href="/company/development/tech/index.html">IIJの最新技術</a></li>
<li><a href="/company/development/tech/activities/index.html">最新の技術動向</a></li>
<li id="current-page">クラウド環境でのルータ設定（後編）</li>
</ol>

<!-- header End --></div>
<!-- header-container End --></div>
<div id="contentsContainer">
<div id="contents">
<ul class="social-box">
<li><a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja">ツイート</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></li>
<li><iframe src="//www.facebook.com/plugins/like.php?href=http://www.iij.ad.jp/company/development/tech/activities/saw1-02/index.html&amp;send=false&amp;layout=button_count&amp;width=105&amp;show_faces=false&amp;font&amp;colorscheme=light&amp;action=like&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:105px; height:21px;" allowTransparency="true"></iframe></li>
<!-- social-box End --></ul>

<h1 class="heading01"><span class="title-text">クラウド環境でのルータ設定(後編)</span></h1>
<p class="align-right">2013年7月25日</p>
<div class="section"><div class="subsection">
<p>2013年1月に発表したSACMをベースとした機能課金モデル<span class="text-red">（※）</span>で無償提供するサービスアダプタ「SA-W1」の開発について、「SEIL(ザイル)シリーズ」での経験を交えてご紹介します。<br />
機器メーカーではないIIJの限られた開発リソースの中で、ISPだからこそのアイデア、設備・運用面での強みを最大限活用して独自の機器を低コストで開発するには、どうすべきなのか、尽きない試行錯誤の一端です。</p>
<ul class="note-text01 element-t20">
<li>（※） SACMとレシピについては、<a href="/news/pressrelease/2013/0122.html">プレスリリース</a>を参照してください。</li>
</ul></div>
<div class="subsection">
<h2 id="anc01" class="heading02"><span class="title-wrapper"><span class="title-text"><span class="title-shadow">スクリプト支援機能第一弾:floatlinkの作成とIPsec VPNへの適用</span></span></span></h2>
<p>まだ広く一般的に使っていただけるような状態ではないのですが、下地作りの第一弾として、SA-W1にはfloatlink機能を搭載しました。これは、あるSA-W1のIPアドレス情報をサーバに自動登録して、他のSA-W1のスクリプトを参照できるようにする仕組みです。ある場所に設置したSA-W1のfloatlink IDとパスワードが分かれば、他のSA-W1からいつでもアドレス情報を取得できます。これにより、静的アドレスでしか動作しないプロトコルや機能を、スクリプトの支援で動的アドレスに対応させることが容易になります。<br />
既存のプロトコルを拡張して動的アドレスに対応させる場合、任意のアドレスからの要求を受け付けてから認証処理を行うなど、処理が複雑になりがちです。しかし、SMFとfloatlinkを利用してアドレス情報を同期していれば、そのような複雑な処理は全てSMFに任せられます。実際にSA-W1ではfloatlinkを利用することで、以下の2つを実現しました。</p>
<ol class="num-list">
<li><span>IPv4-over-IPv6/IPv4-over-IPv4トンネルの自動構築</span> </li>
<li><span>IKEv1のMain modeを使用した安全な鍵交換によるトンネルへのIPsec適用</span> </li>
</ol>
<p>1.は一般的にはトンネルブローカーに分類される動作で、専用のプロトコルもいくつか提案されています。しかし、SA-W1においては、そうしたプロトコルを新規に実装することなく、クラウドに登録した情報とmrubyによる設定値生成で実現しました。</p>
<p>2.はAggressive modeを利用すると、IKEv1単体で動的アドレスに対応することが可能ですが、この構成については古くから認証処理に関してセキュリティ上の懸念が指摘されています。PKIを導入するなど、強固な認証方式を採用することもできますが、大規模な開発が発生します。これに対して、SA-W1では動的アドレス環境であっても大規模なPKI環境は必要ありません(floatlinkサーバへのアクセスにはSSLを利用しますので、サーバ証明書は利用します)。</p></div>
<div class="subsection">
<h2 id="anc01" class="heading02"><span class="title-wrapper"><span class="title-text"><span class="title-shadow">floatlinkサーバ</span></span></span></h2>
<p>floatlinkのIDとIPアドレスの対応を管理するサーバはインターネット上に設置してあり、SMFサーバ群の一部としてIIJが運用しています。IDとIPアドレスの対応という点ではDNSサーバに似た動作をします。実際、独自のDNSサーバを運用する、という案もありましたが、DNSの分散データベースとしての機能はオーバースペックで、余計なリスクを追い込むことになりかねないということで、最低限必要なWeb APIを用意するだけにとどめました。</p>
<p>floatlinkでは、複数のfloatlink ID(=SA-W1)をグループとして扱います。グループは実質的には「顧客」を意味しており、ある顧客は自分のグループに含まれるfloatlink IDに対応するIPアドレスを登録したり、検索したりすることが可能です。グループには顧客ごとの「鍵(パスフレーズ)」が設定されており、鍵を知らない限りグループに所属するfloatlink IDの情報にアクセスすることはできません。</p>
<p>あるSA-W1がfloatlinkサーバにアクセスする際には、「グループ鍵」と操作対象の「floatlink ID」を指定して、アドレスの登録・取得をリクエストします。floatlinkサーバは、ディレクトリ構造を持たない、ごく簡単な連想記憶ファイルシステムに「グループ鍵」と「floatlink ID」に対応する情報を保存しています。この「グループ鍵」と「floatlink ID」は、ハッシュ関数(SHA)にかけられて128ビットのハッシュ値に変換されます。そして、アドレス情報はこのハッシュ値に対応して保持されています。DNSのようなディレクトリ構造や権限委譲のないフラットなデータベースですが、この連想記憶の仕組みにより、高速な検索を実現しています。ハッシュ関数の計算はSA-W1側で実行することも可能ですので、通常、サーバ側では情報検索のための計算はほとんど発生しません。また、問い合わせにステートが含まれることもないので、負荷分散も容易な設計となっています。</p>
<p class="align-center"><img style="BORDER-BOTTOM: #000000 0px solid; BORDER-LEFT: #000000 0px solid; VERTICAL-ALIGN: baseline; BORDER-TOP: #000000 0px solid; BORDER-RIGHT: #000000 0px solid" title="" alt="" src="/company/development/tech/activities/saw1-02/__icsFiles/artimage/2013/07/25/saw12/hsuenaga_2.gif" /></p></div>
<div class="subsection">
<h2 id="anc01" class="heading02"><span class="title-wrapper"><span class="title-text"><span class="title-shadow">今後の展望</span></span></span></h2>
<p>現在のところ、SA-W1に対するスクリプトの組み込みは、IIJの製品開発部隊のみに制限されており、SACMのサーバ側についても、汎用スクリプトの組み込みは、やはり開発部隊に制限しています。ただし、サーバ上で設定値(テキスト情報)を生成する文字列マクロ処理については、SACMを利用したサービスの提供者に開放しており、サービスを利用契約しているSA-W1のIDなどは変数として参照できるようにしています。サービス側でIDをマクロ展開し、SA-W1上でIDからアドレス情報をfloatlink経由で参照するように設定マクロを作成すれば、それを再利用することで、契約に応じて全自動(SMFベースの技術なので電源投入以降はすべて自動処理されます)でフルメッシュのVPNを構築することが可能です。また、サービス仕様に応じてエンドユーザにいくつかのパラメータを入力してもらうことも可能です。最初のステップとしては、ある程度汎用性が高く、プログラミングの知識をそれほど必要としない仕組みになったのではないかと思います。</p>
<p>将来的にはスクリプトの開発をより広範囲にできれば、より柔軟性が高まるように思えます。ただ、単純なマクロ処理と異なり、実行時の難解なエラーや無限ループが容易に発生しうるスクリプトの開発を支援したり、事故の際に影響を最小限に抑える仕組みを構築したりするのは容易ではありません。そのため、別の方向として、現状のfloatlinkによる情報交換の仕組みを、より汎用化していくことも検討しています。また、floatlinkに含まれる、次の1～5までの基本的なパーツを洗練させると、シンプルかつ実用上十分な柔軟性を実現できる可能性もあります。 </p>
<ol class="num-list">
<li><span>SA-W1での状態検知</span> </li>
<li><span>SA-W1 からサーバへの通知</span> </li>
<li><span>通知を受け取ったサーバでの内部処理</span> </li>
<li><span>サーバからSA-W1へのフィードバック</span> </li>
<li><span>SA-W1からのサーバ上の情報参照</span> </li>
</ol>
<p>前述の通り、ネットワーク機器単体で処理するケースはすでに多々ありますが、サーバではリソースの制限があらゆる点で緩やかですし、SMFでは機器の識別、認証、コントロールといった点は、すでに解決しているので、かなり開発は効率的だと思っています。特に、自分の管理下にあるSA-W1の情報を当たり前に参照でき、方法によっては「IIJ GIO」などクラウドサービスのリソースとも連携できるという環境は、IIJならではのサービスに繋がるのではないかと考えています。</p>
<p>この仕組みは、「サービスを利用するための設定」という余計な作業を限りなく少なくできます。その中で今後、SEILシリーズやSA-W1は、エンドユーザからすると、特に存在を意識されない「ちょっと場所を取る邪魔な箱」になっていくでしょう。そう考えると一抹の寂しさはありますが、SEILも今年で15歳を迎え、人知れず縁の下の力持ちとしてがんばる「オトナの製品」になるべき時なのかもしれません。 </p></div>
<div class="col-prof column">
<div class="prof-photo">
<p><img style="BORDER-BOTTOM: #000000 0px solid; BORDER-LEFT: #000000 0px solid; VERTICAL-ALIGN: baseline; BORDER-TOP: #000000 0px solid; BORDER-RIGHT: #000000 0px solid" title="" alt="" src="/company/development/tech/activities/saw1-02/__icsFiles/artimage/2013/07/25/saw12/pic_hsuenaga.jpg" /></p></div><!-- prof-photo End -->
<div class="prof-box">
<p class="prof-title">執筆者プロフィール</p></div>
<div class="prof-text prof-line01 element-t07">
<p><span class="fwb">末永 洋樹（すえなが ひろき）</span></p>
<p class="element-t07">IIJプロダクト本部 プロダクト開発部 マネジメントサービス課<br />2004年IIJ入社。入社後すぐにSEILシリーズのIPsec VPN機能の保守・開発に携わる。その後、SMFv2で利用するARMS プロトコルの仕様策定や、SMFv2システム、SEIL X1/X2の開発業務を経て、SMFv2の対応サービスアダプタで動作するアプリケーションの管理機構の設計（Add-On Framework）とSEILシリーズのIPv6サポートの強化に従事。SMFv2環境でのアプリケーションのあり方の一つとして、開発の敷居が低いスクリプティング開発環境をベースとしてサービスアダプタの機能セットを提供・管理する「レシピ」の開発環境と対応サービスアダプタSA-W1の立ち上げを行い、現在はレシピの材料として使えるアドレス交換機構floatlinkの機能拡張と、VPN技術をベースとする「レシピ」の開発を行っている。</p><!-- prof-text End --></div><!-- prof-box End --></div><!-- col-prof End -->
<div class="col-round02 element-t30">
<p class="col-title">関連リンク</p>
<ul class="normal-list">
<li><a href="/company/development/tech/activities/saw1-01/index.html">最新の技術動向「クラウド環境でのルータ設定（前編）」</a> </li>
<li><a href="/news/pressrelease/2013/0122.html ">2013/01/22 プレスリリース<br />
「IIJ、ネットワーク機器を無償提供し機能に課金する業界初のビジネスモデルを開始」</a> </li>
<li><a href="/company/development/tech/activities/mruby/index.html ">最新の技術動向 「軽量Rubyへの取り組み」</a> </li>
</ul></div></div>
<!-- contents End --></div>
<div id="aside">
<div id="rNavi">

<ul>

<li class="off"><a href="/company/about/index.html"><span>IIJについて</span></a></li>

<li class="off"><a href="/news/index.html"><span>ニュース・イベント</span></a></li>

<li class="active"><a href="/company/development/index.html"><span>研究・開発</span></a>
<ul>
<li class="off"><a href="/company/development/info/2013/index.html">研究開発お知らせ</a></li>
<li class="active"><a href="/company/development/tech/index.html">IIJの最新技術</a>
<ul>
<li class="active"><a href="/company/development/tech/activities/index.html">最新の技術動向</a></li>
<li class="off"><a href="/company/development/tech/techweek/index.html">IIJ Technical WEEK</a></li>
<li class="off"><a href="/company/development/tech/project/index.html">IIJ-IIの研究プロジェクト</a></li>
</ul>
</li>
<li class="off"><a href="/company/development/report/index.html">IIJの技術/セキュリティレポート</a></li>
<li class="off"><a href="/company/development/external/index.html">IIJ技術者の外部活動</a></li>
</ul>
</li>

<li class="off"><a href="/company/network/index.html"><span>ネットワーク</span></a></li>

<li class="off"><a href="/company/recruit/index.html"><span>採用情報</span></a></li>
</ul>
<!-- rNavi End --></div>
<dl class="col-side element-t10">
<dt><span>関連リンク</span></dt>
<dd>
<ul class="link-list">
<li>
<a href="https://sect.iij.ad.jp/" target="_blank" class="blank-link"><span>IIJにおけるセキュリティ活動</span><img src="/common/images/com_icn05.png" alt="blank" width="12" height="11" /></a>
</li>
<li>
<a href="http://techlog.iij.ad.jp/" target="_blank" class="blank-link"><span>IIJ技術者の開発/技術動向ブログ「てくろぐ」</span><img src="/common/images/com_icn05.png" alt="blank" width="12" height="11" /></a>
</li>
<li>
<a href="http://www.iij-ii.co.jp/" target="_blank" class="blank-link"><span>株式会社IIJイノベーションインスティテュート</span><img src="/common/images/com_icn05.png" alt="blank" width="12" height="11" /></a>
</li>
<!-- link-list End -->
</ul>
</dd>
<!-- col-side End -->
</dl>
<!-- aside End --></div>
<!-- contentsContainer End --></div>
<div id="footer-container">
<div id="footer">
<p class="reader">ここからフッターメニューです</p>
<ul id="footer-utility">
<li><a href="/company/about/outline/index.html?i=footlinkcorp">会社概要</a></li>
<li><a href="/company/recruit/index.html?i=footlinkrecruit">採用情報</a></li>
<li><a href="/securitypolicy/index.html">情報セキュリティ基本方針</a></li>
<li><a href="/terms/index.html">サイトについて</a></li>
<li><a href="/privacy/index.html">個人情報保護ポリシー</a></li>
<!-- footer-utility End --></ul>
<div id="utility">
<ul>
<li><a href="javascript:openWin();"><img src="/common/images/ft_logo01.png" width="109" height="29" alt="Ongoing Innovation" /></a></li>
<li class="element-r00"><img src="/common/images/ft_copylight01.png" width="185" height="29" alt="株式会社インターネットイニシアティブ &copy; Internet Initiative Japan Inc." /></li>
</ul>
<!-- utility End --></div>
<p id="footer-up"><a href="#page-wrapper"><img src="/common/images/ft_btn01.gif" width="31" height="123" alt="ページの先頭へ" /></a></p>
<!-- footer End --></div>
<!-- footer-container End --></div>
<hr />
<p class="reader">ページの終わりです</p>
<p class="reader"><a href="#page-wrapper">ページの先頭へ戻る</a></p>
<!-- page-wrapper End --></div>
<!-- ログタグ挿入コンポーネント -->
<script type="text/javascript"> 
   var _cid = 11048;
   var _entry_js = '//tracer02.a-cast.jp/entry.js?cid='; 
   var _proto = window.location.protocol; 
   if (_proto != 'http:' && _proto != 'https:') { 
      _proto = 'http:'; 
   }  
   document.write('<scr' + 'ipt type="text/javascript" ' 
      + 'language="JavaScript" src="' 
      + _proto + _entry_js + _cid + '" ></' + 'scr' + 'ipt>'); 
</script> 


<!-- MarsFinderインテリアドバイザ用Script -->
<script src="http://search2.iij.ad.jp/mf/suggest_ext.js#unitid=ja_all" type="text/javascript" charset="UTF-8"></script>
<!-- /MarsFinderインテリアドバイザ用Script -->
<!--/ ログタグ挿入コンポーネント -->
<!-- MF20121207 -->
</body>
</html>